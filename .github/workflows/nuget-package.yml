name: Gerador pacotes NuGet

on:
  workflow_dispatch:
    inputs:
      versao:
        description: 'Vers√£o'
        required: true

jobs:
  testar:
    runs-on: ubuntu-latest
    
    steps:
      - name: Rodar testes
        uses: lewagon/wait-on-check-action@v1.0.0
        with:
          ref: ${{ github.ref }}
          check-name: buildar_testar
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          allowed-conclusions: success

  gerar_pacote:
    needs: [testar]
    runs-on: ubuntu-latest
    env:
      AMBIENTE_DESTINO: Release
      CAMINHO_PROJETO: ./Library/Library.csproj
      DIRETORIO_DESTINO_PACOTE: ${{ github.workspace }}/out

    steps:
      - uses: actions/checkout@v2

      - name: Setup .NET
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 5.0.x

      - name: Publicar pacote nuget
        id: publish_nuget
        uses: rohith/publish-nuget@v2
        with:
          PROJECT_FILE_PATH: ${{ env.CAMINHO_PROJETO }}
          VERSION_STATIC: ${{ github.event.inputs.versao }}
          NUGET_KEY: ${{ secrets.NUGET_API_KEY }}
          NUGET_SOURCE: ${{ secrets.NUGET_SERVER }}
